{"version":3,"sources":["assets/Script/base/sound/ak-g1009-sfs-player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import G1009SoundPlayerActor from \"./aka-g1009-sound-player\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class G1009SFXPlayerActor extends G1009SoundPlayerActor {\n\n    isMute: boolean = false;\n    muteVolume: number = 1;\n    audioPlayings: any = {};\n    tweenFadeOuts: cc.Tween = cc.tween();\n\n    protected start(): void {\n        for (let index = 0, length = this.audioClips.length; index < length; index++)\n        {\n            let clip = this.audioClips[index];\n            this.audioPlayings[clip.name] = [];\n            this.tweenFadeOuts[clip.name] = cc.tween();\n        }\n    }\n  \n    private handleAudioClipLoaded(audioID: number, audioName: string, isLoop: boolean): void {\n\n        let startLoadTime = Date.now();\n        this.audioClips[audioName].once(\"load\", function () {\n            if (this.audioPlayings[audioName].indexOf(audioID) == -1)\n            {\n                cc.audioEngine.stopEffect(audioID);\n                return;\n            }\n\n            let totalLoadTime = (Date.now() - startLoadTime) / 1000;\n            if (totalLoadTime > this.GetAudioDuration(audioName) && isLoop == false)\n            {\n                this.Stop(audioName);\n            } else\n            {\n                let audioCurrentTime = totalLoadTime % this.GetAudioDuration(audioName);\n                cc.audioEngine.setCurrentTime(audioID, audioCurrentTime);\n            }\n        });\n    }\n\n    public AddAudio(audioClip: cc.AudioClip): void {\n      \n        if (audioClip instanceof cc.AudioClip && this.audioClips[audioClip.name] == null)\n        {\n            this.audioClips[audioClip.name] = audioClip;\n            this.audioClips.push(audioClip);\n            this.audioPlayings[audioClip.name] = [];\n            this.tweenFadeOuts[audioClip.name] = cc.tween();\n        }\n    }\n\n    public Play(audioName: string, isLoop: boolean): void {\n      \n        if (this.audioClips[audioName] != null)\n        {\n            let audioID = cc.audioEngine.playEffect(this.audioClips[audioName], isLoop);\n            this.audioPlayings[audioName].push(audioID);\n\n            cc.audioEngine.setFinishCallback(audioID, function (id) {\n                return function () {\n                    cc.js.array.fastRemove(this.audioPlayings[audioName], id);\n                }\n            }(audioID).bind(this));\n\n            if (!this.audioClips[audioName].loaded)\n            {\n                this.handleAudioClipLoaded(audioID, audioName, isLoop);\n            }\n        }\n    }\n\n    public Stop(audioName: string): void {\n      \n        if (this.audioClips[audioName] != null && this.audioPlayings[audioName].length > 0)\n        {\n            for (let index = 0; index < this.audioPlayings[audioName].length; index++)\n            {\n                let audioID = this.audioPlayings[audioName][index];\n                cc.audioEngine.stopEffect(audioID);\n            }\n            this.audioPlayings[audioName] = [];\n            this.tweenFadeOuts[audioName].stop()\n        }\n    }\n\n    public StopWithFadeOut(audioName: string, duration: number) {\n       \n        if (this.audioClips[audioName] != null && this.audioPlayings[audioName].length > 0)\n        {\n            let audioIDs = this.audioPlayings[audioName];\n            let saveVolume = cc.audioEngine.getVolume(audioIDs[0]);\n            let obj = {\n                _volume: saveVolume,\n                get volume() {\n                    return this._volume\n                },\n                set volume(val) {\n                    this._volume = val;\n                    audioIDs.forEach(item => cc.audioEngine.setVolume(item, this._volume));\n                }\n            };\n\n            let tweenFade = this.tweenFadeOuts[audioName];\n            tweenFade.stop()\n            tweenFade = cc.tween(obj);\n            tweenFade.to(duration, {\n                volume: 0\n            });\n            tweenFade.call(() => {\n                audioIDs.forEach(item => cc.audioEngine.setVolume(item, saveVolume));\n                this.Stop(audioName);\n            });\n            tweenFade.start();\n        }\n    }\n\n    public StopAll(): void {\n       \n        for (let audioName in this.audioPlayings)\n        {\n            this.Stop(audioName);\n        }\n    }\n\n    public StopAllNonLoopingSfx(): void {\n        for (let audioName in this.audioPlayings)\n        {\n            if (!this.CheckAudioLoop(audioName))\n            {\n                this.Stop(audioName);\n            }\n        }\n    }\n\n    public StopAllWithFadeOut(duration: number): void {\n \n        for (let audioName in this.audioPlayings)\n        {\n            this.StopWithFadeOut(audioName, duration);\n        }\n    }\n\n    public StopAllNonLoopingSfxWithFadeOut(duration: number): void {\n    \n        for (let audioName in this.audioPlayings)\n        {\n            if (!this.CheckAudioLoop(audioName))\n            {\n                this.StopWithFadeOut(audioName, duration);\n            }\n        }\n    }\n\n    public Mute(): void {\n       \n        if (this.isMute == false)\n        {\n            this.isMute = true;\n            this.muteVolume = cc.audioEngine.getEffectsVolume();\n            cc.audioEngine.setEffectsVolume(0);\n        }\n    }\n\n    public Unmute(): void {\n        \n        if (this.isMute)\n        {\n            this.isMute = false;\n            cc.audioEngine.setEffectsVolume(this.muteVolume);\n        }\n    }\n\n    public IsMute(): boolean {\n   \n        return this.isMute;\n    }\n\n    public SetVolume(volume): void {\n        \n        if (this.isMute)\n        {\n            this.muteVolume = volume;\n        } else\n        {\n            cc.audioEngine.setEffectsVolume(volume);\n        }\n    }\n\n    public GetVolume(): number {\n      \n        if (this.isMute)\n        {\n            return this.muteVolume;\n        } else\n        {\n            return cc.audioEngine.getEffectsVolume();\n        }\n    }\n\n    public GetAudioDuration(audioName): any {\n        \n        if (this.audioClips[audioName] != null)\n        {\n            return this.audioClips[audioName].duration;\n        }\n    }\n\n    public CheckAudioLoop(audioName): boolean {\n       \n        let isAudioLoop = false;\n        let audioPlaying = this.audioPlayings[audioName];\n        audioPlaying.forEach(function (audioID) {\n            if (cc.audioEngine.isLoop(audioID))\n            {\n                isAudioLoop = true;\n            }\n        });\n\n        return isAudioLoop;\n    }\n}\n"]}