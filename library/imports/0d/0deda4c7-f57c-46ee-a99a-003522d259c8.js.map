{"version":3,"sources":["assets/Script/UI/big-win/aka-g1009-big-win-actor.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import G1009Util from \"../../base/Util/aka-g1009-number-converter\";\nimport { G1009EventManager } from \"../../base/events/aka-g1009-event-manager\";\nimport { G1009BetModel } from \"../../models/aka-g1009-bet-model\";\nconst { ccclass, property } = cc._decorator;\n\nconst FADE_DURATION = 0.25;\nconst COUNT_POINT_DURATION1 = 1.75;\nconst COUNT_POINT_DURATION2 = 0.75;\nconst COUNT_POINT_DURATION3 = 0.75;\nconst IDLE_DURATION = 2.5;\nconst SUPER_WIN_TRIGGER_POINT = 10;\n\n@ccclass\nexport default class G1009BigwinActor extends cc.Component {\n\n\t@property(cc.Node)\n\tcontent: cc.Node = null;\n\t@property(sp.Skeleton)\n\tprivate spine: sp.Skeleton = null;\n\t@property(sp.SkeletonData)\n\tprivate skeletonData: sp.SkeletonData = null;\n\t@property(cc.Label)\n\tlblTotalWinPoint: cc.Label = null;\n\n\tprivate tweenShowPopup: cc.Tween;\n\tprivate tweenCountPoint: cc.Tween;\n\tprivate currentWinPoint: number = 0;\n\tprivate totalWin: number = 0;\n\tprivate isStopImmediately: boolean = false;\n\tprivate duration: number = 4;\n\n\tprotected onLoad(): void {\n\t\tthis.reset();\n\t\tthis.register();\n\t}\n\n\tprivate register(): void {\n\t\tG1009EventManager.GetInstance().register(\"BigWinStarted\", this.onBigWinStarted.bind(this));\n\t\tG1009EventManager.GetInstance().register(\"SpinStarted\", this.onSpinStarted.bind(this));\n\t\tG1009EventManager.GetInstance().register(\"StopImmediately\", this.onStopImmediately.bind(this));\n\t}\n\n\tprivate onBigWinStarted(point: number): void {\n\t\t// if (this.isStopImmediately)\n\t\t// {\n\t\t// \tthis.speedUpAnimation();\n\t\t// \treturn;\n\t\t// }\n\t\tG1009EventManager.GetInstance().notify(\"BigWinPresentationStarted\");\n\n\t\tlet objTween = {\n\t\t\tvalue: 0\n\t\t};\n\n\t\tthis.totalWin = point;\n\n\t\tthis.tweenShowPopup = cc.tween(this.spine.node)\n\t\t\t.to(FADE_DURATION, { scale: 1 })\n\t\t\t.call(() => {\n\t\t\t\tthis.content.active = true;\n\t\t\t\tthis.spine.skeletonData = this.skeletonData;\n\t\t\t\tthis.spine.setSkin(this.getNameSkinAnimation(point));\n\t\t\t\tlet track = this.spine.setAnimation(0, \"animation\", false);\n\t\t\t\tcc.tween(this.content)\n\t\t\t\t\t.to(FADE_DURATION, { opacity: 255 })\n\t\t\t\t\t.call(() => {\n\t\t\t\t\t\tthis.countPoint(objTween, this.totalWin, this.duration - FADE_DURATION - IDLE_DURATION);\n\t\t\t\t\t})\n\t\t\t\t\t.start();\n\t\t\t})\n\t\tthis.tweenShowPopup.start();\n\t}\n\n\tprivate getNameSkinAnimation(point: number): string {\n\t\tvar nameSkin = point / G1009BetModel.GetInstance().GetTotalBetPoint() >= SUPER_WIN_TRIGGER_POINT ? \"thangsieulon\" : \"thanglon\";\n\t\treturn nameSkin;\n\t}\n\n\tprivate countPoint(objTween: { value: number; }, point1: number, duration: number, delay: number = 0, callback = () => { }) {\n\t\tthis.tweenCountPoint = cc.tween(objTween)\n\t\t\t.delay(delay)\n\t\t\t.to(duration, { value: point1 }, {\n\t\t\t\tprogress: (start: any, end: any, current: any, ratio: any) => {\n\t\t\t\t\tthis.currentWinPoint = Math.round(current);\n\t\t\t\t\tthis.lblTotalWinPoint.string = G1009Util.Instance().NumberFormatWithoutCharacter(this.currentWinPoint);\n\t\t\t\t\treturn start + (end - start) * ratio;\n\t\t\t\t}\n\t\t\t})\n\t\t\t.call(() => {\n\t\t\t\tthis.lblTotalWinPoint.string = G1009Util.Instance().NumberFormatWithoutCharacter(point1);\n\t\t\t})\n\t\t\t.delay(IDLE_DURATION)\n\t\t\t.call(() => {\n\t\t\t\tcc.tween(this.content)\n\t\t\t\t\t.to(FADE_DURATION, { opacity: 0 }).call(() => {\n\t\t\t\t\t\tG1009EventManager.GetInstance().notify(\"BigWinCompleted\");\n\t\t\t\t\t\tthis.reset();\n\t\t\t\t\t})\n\t\t\t\t\t.start();\n\t\t\t});\n\t\tthis.tweenCountPoint.start();\n\t}\n\n\tprivate reset(): void {\n\t\tthis.spine.skeletonData = null;\n\t\tthis.lblTotalWinPoint.string = \"\";\n\t\tthis.content.active = false;\n\t\tthis.content.opacity = 0;\n\t}\n\n\tpublic speedUpAnimation() {\n\t\tthis.tweenCountPoint && this.tweenCountPoint.stop();\n\t\tthis.tweenShowPopup && this.tweenShowPopup.stop();\n\t\tlet objTween = {\n\t\t\tvalue: this.currentWinPoint\n\t\t};\n\t\tthis.countPoint(objTween, this.totalWin, 0);\n\t}\n\n\tprivate onSpinStarted(): void {\n\t\t// this.duration = COUNT_POINT_DURATION1 + COUNT_POINT_DURATION2 + COUNT_POINT_DURATION3;\n\t\t// this.isStopImmediately = false;\n\t}\n\n\tprivate onStopImmediately(): void {\n\t\tthis.duration = 0;\n\t}\n}\n"]}