{"version":3,"sources":["assets\\Script\\UI\\big-win\\Slot45-big-win-actor.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,mFAAiE;AACjE,+EAA4E;AAC5E,kEAA+D;AACzD,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAE5C,IAAM,aAAa,GAAG,IAAI,CAAC;AAC3B,IAAM,qBAAqB,GAAG,IAAI,CAAC;AACnC,IAAM,qBAAqB,GAAG,IAAI,CAAC;AACnC,IAAM,qBAAqB,GAAG,IAAI,CAAC;AACnC,IAAM,aAAa,GAAG,GAAG,CAAC;AAC1B,IAAM,uBAAuB,GAAG,EAAE,CAAC;AAGnC;IAA+C,qCAAY;IAA3D;QAAA,qEAoHC;QAjHA,aAAO,GAAY,IAAI,CAAC;QAEhB,WAAK,GAAgB,IAAI,CAAC;QAE1B,oBAAc,GAAoB,IAAI,CAAC;QAEvC,qBAAe,GAAoB,IAAI,CAAC;QAEhD,sBAAgB,GAAa,IAAI,CAAC;QAI1B,qBAAe,GAAW,CAAC,CAAC;QAC5B,cAAQ,GAAW,CAAC,CAAC;QACrB,uBAAiB,GAAY,KAAK,CAAC;QACnC,cAAQ,GAAW,CAAC,CAAC;;IAkG9B,CAAC;IAhGU,kCAAM,GAAhB;QACC,IAAI,CAAC,KAAK,EAAE,CAAC;QACb,IAAI,CAAC,QAAQ,EAAE,CAAC;IACjB,CAAC;IAEO,oCAAQ,GAAhB;QACC,yCAAkB,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,eAAe,EAAE,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAC5F,yCAAkB,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,aAAa,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACxF,yCAAkB,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,iBAAiB,EAAE,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;IACjG,CAAC;IAEO,2CAAe,GAAvB,UAAwB,KAAa;QAArC,iBA6BC;QA5BA,8BAA8B;QAC9B,IAAI;QACJ,4BAA4B;QAC5B,WAAW;QACX,IAAI;QACJ,yCAAkB,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC,2BAA2B,CAAC,CAAC;QAErE,IAAI,QAAQ,GAAG;YACd,KAAK,EAAE,CAAC;SACR,CAAC;QAEF,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,IAAI,KAAK,GAAG,KAAK,GAAG,iCAAc,CAAC,WAAW,EAAE,CAAC,gBAAgB,EAAE,CAAC;QACpE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,KAAK,IAAI,uBAAuB,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;QAChE,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;aAC7C,EAAE,CAAC,aAAa,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC;aAC/B,IAAI,CAAC;YACL,KAAI,CAAC,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC;YAC3B,KAAI,CAAC,KAAK,CAAC,YAAY,GAAG,KAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;YACnD,IAAI,KAAK,GAAyB,KAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC,EAAE,WAAW,EAAE,KAAK,CAAC,CAAC;YACjF,EAAE,CAAC,KAAK,CAAC,KAAI,CAAC,OAAO,CAAC;iBACpB,EAAE,CAAC,aAAa,EAAE,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC;iBACnC,IAAI,CAAC;gBACL,KAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,KAAI,CAAC,QAAQ,EAAE,KAAI,CAAC,QAAQ,GAAG,aAAa,GAAG,aAAa,CAAC,CAAC;YACzF,CAAC,CAAC;iBACD,KAAK,EAAE,CAAC;QACX,CAAC,CAAC,CAAA;QACH,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC;IAC7B,CAAC;IAEO,wCAAY,GAApB,UAAqB,KAAa;QACjC,IAAI,YAAY,GAAI,KAAK,IAAI,uBAAuB,CAAC,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC;QAClG,OAAO,YAAY,CAAC;IACrB,CAAC;IAEO,sCAAU,GAAlB,UAAmB,QAA4B,EAAE,MAAc,EAAE,QAAgB,EAAE,KAAiB,EAAE,QAAoB;QAA1H,iBAuBC;QAvBkF,sBAAA,EAAA,SAAiB;QAAE,yBAAA,EAAA,yBAAmB,CAAC;QACzH,IAAI,CAAC,eAAe,GAAG,EAAE,CAAC,KAAK,CAAC,QAAQ,CAAC;aACvC,KAAK,CAAC,KAAK,CAAC;aACZ,EAAE,CAAC,QAAQ,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE;YAChC,QAAQ,EAAE,UAAC,KAAU,EAAE,GAAQ,EAAE,OAAY,EAAE,KAAU;gBACxD,KAAI,CAAC,eAAe,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;gBAC3C,KAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,iCAAU,CAAC,QAAQ,EAAE,CAAC,4BAA4B,CAAC,KAAI,CAAC,eAAe,CAAC,CAAC;gBACxG,OAAO,KAAK,GAAG,CAAC,GAAG,GAAG,KAAK,CAAC,GAAG,KAAK,CAAC;YACtC,CAAC;SACD,CAAC;aACD,IAAI,CAAC;YACL,KAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,iCAAU,CAAC,QAAQ,EAAE,CAAC,4BAA4B,CAAC,MAAM,CAAC,CAAC;QAC3F,CAAC,CAAC;aACD,KAAK,CAAC,aAAa,CAAC;aACpB,IAAI,CAAC;YACL,EAAE,CAAC,KAAK,CAAC,KAAI,CAAC,OAAO,CAAC;iBACpB,EAAE,CAAC,aAAa,EAAE,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC;gBACvC,yCAAkB,CAAC,WAAW,EAAE,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;gBAC3D,KAAI,CAAC,KAAK,EAAE,CAAC;YACd,CAAC,CAAC;iBACD,KAAK,EAAE,CAAC;QACX,CAAC,CAAC,CAAC;QACJ,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;IAC9B,CAAC;IAEO,iCAAK,GAAb;QACC,IAAI,CAAC,KAAK,CAAC,YAAY,GAAG,IAAI,CAAC;QAC/B,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,EAAE,CAAC;QAClC,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,KAAK,CAAC;QAC5B,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,CAAC,CAAC;IAC1B,CAAC;IAEM,4CAAgB,GAAvB;QACC,IAAI,CAAC,eAAe,IAAI,IAAI,CAAC,eAAe,CAAC,IAAI,EAAE,CAAC;QACpD,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC;QAClD,IAAI,QAAQ,GAAG;YACd,KAAK,EAAE,IAAI,CAAC,eAAe;SAC3B,CAAC;QACF,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;IAC7C,CAAC;IAEO,yCAAa,GAArB;QACC,oBAAoB;QACpB,kCAAkC;IACnC,CAAC;IAEO,6CAAiB,GAAzB;QACC,qBAAqB;IACtB,CAAC;IAhHD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;sDACM;IAExB;QADC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC;oDACY;IAElC;QADC,QAAQ,CAAC,EAAE,CAAC,YAAY,CAAC;6DACqB;IAE/C;QADC,QAAQ,CAAC,EAAE,CAAC,YAAY,CAAC;8DACsB;IAEhD;QADC,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;+DACe;IAXd,iBAAiB;QADrC,OAAO;OACa,iBAAiB,CAoHrC;IAAD,wBAAC;CApHD,AAoHC,CApH8C,EAAE,CAAC,SAAS,GAoH1D;kBApHoB,iBAAiB","file":"","sourceRoot":"/","sourcesContent":["import Slot45Util from \"../../base/Util/Slot45-number-converter\";\r\nimport { Slot45EventManager } from \"../../base/events/Slot45-event-manager\";\r\nimport { Slot45BetModel } from \"../../models/Slot45-bet-model\";\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nconst FADE_DURATION = 0.25;\r\nconst COUNT_POINT_DURATION1 = 1.75;\r\nconst COUNT_POINT_DURATION2 = 0.75;\r\nconst COUNT_POINT_DURATION3 = 0.75;\r\nconst IDLE_DURATION = 2.5;\r\nconst SUPER_WIN_TRIGGER_POINT = 10;\r\n\r\n@ccclass\r\nexport default class Slot45BigwinActor extends cc.Component {\r\n\r\n\t@property(cc.Node)\r\n\tcontent: cc.Node = null;\r\n\t@property(sp.Skeleton)\r\n\tprivate spine: sp.Skeleton = null;\r\n\t@property(sp.SkeletonData)\r\n\tprivate skeletonDataTL: sp.SkeletonData = null;\r\n\t@property(sp.SkeletonData)\r\n\tprivate skeletonDataTSL: sp.SkeletonData = null;\r\n\t@property(cc.Label)\r\n\tlblTotalWinPoint: cc.Label = null;\r\n\r\n\tprivate tweenShowPopup: cc.Tween;\r\n\tprivate tweenCountPoint: cc.Tween;\r\n\tprivate currentWinPoint: number = 0;\r\n\tprivate totalWin: number = 0;\r\n\tprivate isStopImmediately: boolean = false;\r\n\tprivate duration: number = 4;\r\n\r\n\tprotected onLoad(): void {\r\n\t\tthis.reset();\r\n\t\tthis.register();\r\n\t}\r\n\r\n\tprivate register(): void {\r\n\t\tSlot45EventManager.GetInstance().register(\"BigWinStarted\", this.onBigWinStarted.bind(this));\r\n\t\tSlot45EventManager.GetInstance().register(\"SpinStarted\", this.onSpinStarted.bind(this));\r\n\t\tSlot45EventManager.GetInstance().register(\"StopImmediately\", this.onStopImmediately.bind(this));\r\n\t}\r\n\r\n\tprivate onBigWinStarted(point: number): void {\r\n\t\t// if (this.isStopImmediately)\r\n\t\t// {\r\n\t\t// \tthis.speedUpAnimation();\r\n\t\t// \treturn;\r\n\t\t// }\r\n\t\tSlot45EventManager.GetInstance().notify(\"BigWinPresentationStarted\");\r\n\r\n\t\tlet objTween = {\r\n\t\t\tvalue: 0\r\n\t\t};\r\n\r\n\t\tthis.totalWin = point;\r\n\t\tvar multi = point / Slot45BetModel.GetInstance().GetTotalBetPoint();\r\n\t\tthis.spine.node.y = multi >= SUPER_WIN_TRIGGER_POINT ? 56 : -90;\r\n\t\tthis.tweenShowPopup = cc.tween(this.spine.node)\r\n\t\t\t.to(FADE_DURATION, { scale: 1 })\r\n\t\t\t.call(() => {\r\n\t\t\t\tthis.content.active = true;\r\n\t\t\t\tthis.spine.skeletonData = this.getAnimation(multi);\r\n\t\t\t\tlet track : sp.spine.TrackEntry = this.spine.setAnimation(0, \"animation\", false);\r\n\t\t\t\tcc.tween(this.content)\r\n\t\t\t\t\t.to(FADE_DURATION, { opacity: 255 })\r\n\t\t\t\t\t.call(() => {\r\n\t\t\t\t\t\tthis.countPoint(objTween, this.totalWin, this.duration - FADE_DURATION - IDLE_DURATION);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.start();\r\n\t\t\t})\r\n\t\tthis.tweenShowPopup.start();\r\n\t}\r\n\r\n\tprivate getAnimation(multi: number): sp.SkeletonData {\r\n\t\tvar skeletonData =  multi >= SUPER_WIN_TRIGGER_POINT ? this.skeletonDataTSL : this.skeletonDataTL;\r\n\t\treturn skeletonData;\r\n\t}\r\n\r\n\tprivate countPoint(objTween: { value: number; }, point1: number, duration: number, delay: number = 0, callback = () => { }) {\r\n\t\tthis.tweenCountPoint = cc.tween(objTween)\r\n\t\t\t.delay(delay)\r\n\t\t\t.to(duration, { value: point1 }, {\r\n\t\t\t\tprogress: (start: any, end: any, current: any, ratio: any) => {\r\n\t\t\t\t\tthis.currentWinPoint = Math.round(current);\r\n\t\t\t\t\tthis.lblTotalWinPoint.string = Slot45Util.Instance().NumberFormatWithoutCharacter(this.currentWinPoint);\r\n\t\t\t\t\treturn start + (end - start) * ratio;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.call(() => {\r\n\t\t\t\tthis.lblTotalWinPoint.string = Slot45Util.Instance().NumberFormatWithoutCharacter(point1);\r\n\t\t\t})\r\n\t\t\t.delay(IDLE_DURATION)\r\n\t\t\t.call(() => {\r\n\t\t\t\tcc.tween(this.content)\r\n\t\t\t\t\t.to(FADE_DURATION, { opacity: 0 }).call(() => {\r\n\t\t\t\t\t\tSlot45EventManager.GetInstance().notify(\"BigWinCompleted\");\r\n\t\t\t\t\t\tthis.reset();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.start();\r\n\t\t\t});\r\n\t\tthis.tweenCountPoint.start();\r\n\t}\r\n\r\n\tprivate reset(): void {\r\n\t\tthis.spine.skeletonData = null;\r\n\t\tthis.lblTotalWinPoint.string = \"\";\r\n\t\tthis.content.active = false;\r\n\t\tthis.content.opacity = 0;\r\n\t}\r\n\r\n\tpublic speedUpAnimation() {\r\n\t\tthis.tweenCountPoint && this.tweenCountPoint.stop();\r\n\t\tthis.tweenShowPopup && this.tweenShowPopup.stop();\r\n\t\tlet objTween = {\r\n\t\t\tvalue: this.currentWinPoint\r\n\t\t};\r\n\t\tthis.countPoint(objTween, this.totalWin, 0);\r\n\t}\r\n\r\n\tprivate onSpinStarted(): void {\r\n\t\t// this.duration =4;\r\n\t\t// this.isStopImmediately = false;\r\n\t}\r\n\r\n\tprivate onStopImmediately(): void {\r\n\t\t// this.duration = 0;\r\n\t}\r\n}\r\n"]}