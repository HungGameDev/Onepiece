{"version":3,"sources":["assets/Script/avenger-game/spin-panel/avenger-spin-item.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import G1009CellItemActor from \"../../UI/spin-panel/aka-g1009-cell-item\";\nimport G1009SpinItemActor, { ESpinningState } from \"../../UI/spin-panel/aka-g1009-spin-item\";\nimport { G1009SpinItemData } from \"../../UI/spin-panel/aka-g1009-spin-item-data\";\nimport { G1009EventManager } from \"../../base/events/aka-g1009-event-manager\";\nimport { SpinPanelConfig } from \"./avenger-spin-panel-config\";\n\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport default class AvengerSpinItem extends G1009SpinItemActor {\n\n\tprivate arrStartYPosCellItem = [];\n\tpublic onExplodeCompleted: Function = () => { };\n\n\tlateUpdate(dt: number): void {\n\t}\n\tprotected fixUpdate(): void {\n\t}\n\n\tonLoad(): void {\n\t\tthis.cellItems.forEach(cell => {\n\t\t\tthis.arrStartYPosCellItem.push(cell.node.y);\n\t\t});\n\t}\n\n\tscroll(): void {\n\t\tthis.state = ESpinningState.Scroll;\n\t\tfor (let cellIndex = 0; cellIndex < this.cellItems.length; cellIndex++) {\n\t\t\tconst cellItem = this.cellItems[cellIndex];\n\n\t\t\tlet startYPosition = this.arrStartYPosCellItem[cellIndex];\n\t\t\tlet endYPosition = startYPosition - this.node.height - SpinPanelConfig.SpawnedOffsetHeight;\n\t\t\tlet spawnedYPosition = startYPosition + this.node.height + SpinPanelConfig.SpawnedOffsetHeight;\n\t\t\tlet count = cellIndex;\n\n\t\t\tvar tweenDropDown = cc.tween(cellItem.node)\n\t\t\t\t.to(SpinPanelConfig.DropDownDuration, { y: endYPosition }, { easing: SpinPanelConfig.EasingDropDown })\n\t\t\t\t.call(() => {\n\t\t\t\t\tcellItem.node.y = spawnedYPosition;\n\t\t\t\t\tif (count == this.cellItems.length - 1) {\n\t\t\t\t\t\tthis.onReadyToStop(this.cellIndices);\n\t\t\t\t\t}\n\t\t\t\t}).start();\n\t\t}\n\t}\n\n\tstopScroll(): void {\n\t\tthis.state = ESpinningState.StopScroll;\n\t\tfor (let cellIndex = 0; cellIndex < this.cellItems.length; cellIndex++) {\n\t\t\tconst cellItem = this.cellItems[cellIndex];\n\t\t\tlet endYPosition = this.arrStartYPosCellItem[cellIndex];\n\t\t\tlet count = cellIndex;\n\t\t\tvar tweenDropDown = cc.tween(cellItem.node)\n\t\t\t\t.to(SpinPanelConfig.DropDownDuration, { y: endYPosition }, { easing: SpinPanelConfig.EasingDropDown })\n\t\t\t\t.call(()=>{G1009EventManager.GetInstance().notify('CellDropCompleted', cellItem.GetCellIndex());})\n\t\t\t\t.to(SpinPanelConfig.RotationDuration, { angle: SpinPanelConfig.ShakeRotation }, { easing: SpinPanelConfig.EasingDropDown })\n\t\t\t\t.to(SpinPanelConfig.BounceDuration, { y: endYPosition + SpinPanelConfig.BouncedOffsetHeight, angle: -SpinPanelConfig.ShakeRotation / 2 }, { easing: SpinPanelConfig.EasingDropDown })\n\t\t\t\t.to(SpinPanelConfig.BounceDuration, { y: endYPosition - SpinPanelConfig.BouncedOffsetHeight / 2, angle: 0 }, { easing: SpinPanelConfig.EasingDropDown })\n\t\t\t\t.to(SpinPanelConfig.BounceDuration, { y: endYPosition }, { easing: SpinPanelConfig.EasingDropDown })\n\t\t\t\t.call(() => {\n\t\t\t\t\tif (count == this.cellItems.length - 1) {\n\t\t\t\t\t\tthis.onReadyBounceUp();\n\t\t\t\t\t\tthis.stopComplete();\n\t\t\t\t\t}\n\t\t\t\t}).start();\n\t\t}\n\t}\n\n\tprotected setFinalResults(): void {\n\t\tlet resultIndex = 0;\n\t\tfor (let index = 0; index < this.cellItems.length; index++) {\n\t\t\tlet cellItem = this.cellItems[index];\n\t\t\tlet cellIndex = this.originIndices[index];\n\t\t\tcellItem.SetCellIndex(cellIndex);\n\t\t\tif (cellIndex >= 0) {\n\t\t\t\tcellItem.SetItem(this.rawResultItems[resultIndex++]);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic StartExplodeCells(explodedCells, arrNewItem) {\n\t\tvar arrNodeExplodedCell = [];\n\t\texplodedCells.forEach(id => {\n\t\t\tfor (let index = 0; index < this.cellItems.length; index++) {\n\t\t\t\tconst cellItem = this.cellItems[index];\n\t\t\t\tif (cellItem.GetCellIndex() == id) {\n\t\t\t\t\tthis.cellItems.splice(index, 1);\n\t\t\t\t\tthis.cellItems.unshift(cellItem);\n\t\t\t\t\tarrNodeExplodedCell.unshift(cellItem.node);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tfor (let index = 0; index < arrNodeExplodedCell.length; index++) {\n\t\t\tconst node = arrNodeExplodedCell[index];\n\t\t\tlet count = index;\n\t\t\tvar tweenExplode = cc.tween(node)\n\t\t\t\t.to(SpinPanelConfig.FadeCellDuration, { opacity: 0 }, { easing: 'linear' })\n\t\t\t\t.delay(SpinPanelConfig.ExplodeDuration - SpinPanelConfig.FadeCellDuration)\n\t\t\t\t.call(() => {\n\t\t\t\t\tlet startYPosition = this.arrStartYPosCellItem[count];\n\t\t\t\t\tnode.y = startYPosition + this.node.height;\n\t\t\t\t\tnode.opacity = 255;\n\n\t\t\t\t\tif (count == arrNodeExplodedCell.length - 1) {\n\t\t\t\t\t\tfor (let index = 0; index < this.cellItems.length; index++) {\n\t\t\t\t\t\t\tthis.cellItems[index].SetCellIndex(this.cellIndices[index]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.rawResultItems= [];\n\t\t\t\t\t\tthis.resultItems = [];\n\t\t\t\t\t\tthis.setResultItems(arrNewItem);\n\t\t\t\t\t\tthis.setFinalResults();\n\n\t\t\t\t\t\tthis.stopExplodeCells(arrNodeExplodedCell);\n\t\t\t\t\t}\n\t\t\t\t}).start();\n\t\t}\n\t}\n\n\tprivate stopExplodeCells(arrNodeExplodedCell) {\n\t\tfor (let index = 0; index < this.cellItems.length; index++) {\n\t\t\tconst cellItem = this.cellItems[index];\n\t\t\tlet count = index;\n\t\t\tlet desYPostion = this.arrStartYPosCellItem[index];\n\t\t\tif (desYPostion != cellItem.node.y) {\n\t\t\t\t\n\t\t\t\tvar tweenDropDown = cc.tween(cellItem.node)\n\t\t\t\t\t.to(SpinPanelConfig.DropDownDuration, { y: desYPostion }, { easing: SpinPanelConfig.EasingDropDown })\n\t\t\t\t\t.call(()=>{G1009EventManager.GetInstance().notify('CellDropCompleted', cellItem.GetCellIndex());})\n\t\t\t\t\t.to(SpinPanelConfig.RotationDuration, { angle: SpinPanelConfig.ShakeRotation }, { easing: SpinPanelConfig.EasingDropDown })\n\t\t\t\t\t.to(SpinPanelConfig.BounceDuration, { y: desYPostion + SpinPanelConfig.BouncedOffsetHeight, angle: -SpinPanelConfig.ShakeRotation / 2 }, { easing: SpinPanelConfig.EasingDropDown })\n\t\t\t\t\t.to(SpinPanelConfig.BounceDuration, { y: desYPostion - SpinPanelConfig.BouncedOffsetHeight / 2, angle: 0 }, { easing: SpinPanelConfig.EasingDropDown })\n\t\t\t\t\t.to(SpinPanelConfig.BounceDuration, { y: desYPostion }, { easing: SpinPanelConfig.EasingDropDown })\n\t\t\t\t\t.call(() => {\n\t\t\t\t\t\tif (count == arrNodeExplodedCell.length - 1) {\n\t\t\t\t\t\t\tthis.onExplodeCompleted();\n\t\t\t\t\t\t}\n\t\t\t\t\t}).start();\n\t\t\t}\n\t\t}\n\t}\n}\n"]}