{"version":3,"sources":["assets/Script/UI/jackpot/aka-g1009-jackpot-actor.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import G1009Util from \"../../base/Util/aka-g1009-number-converter\";\nimport G1009GameController from \"../../base/controller/aka-g1009-game-controller\";\nimport { G1009EventManager } from \"../../base/events/aka-g1009-event-manager\";\nconst { ccclass, property } = cc._decorator;\n\nconst FADE_DURATION = 0.25;\nconst COUNT_POINT_DURATION = 2;\nconst IDLE_DURATION = 1;\n@ccclass\nexport default class G1009JackpotActor extends cc.Component {\n\n\t@property(cc.Node)\n\tcontent: cc.Node = null;\n\t@property(sp.Skeleton)\n\tprivate spine: sp.Skeleton = null;\n\t@property(sp.SkeletonData)\n\tprivate skeletonData: sp.SkeletonData = null;\n\t@property(cc.Label)\n\tlblTotalWinPoint: cc.Label = null;\n\n\tprivate tweenShowPopup: cc.Tween;\n\tprivate tweenCountPoint: cc.Tween;\n\tprivate currentWinPoint: number = 0;\n\tprivate jackpotWinPoint: number = 0;\n\tprivate isStopImmediately: boolean = false;\n\n\tprotected onLoad(): void {\n\t\tthis.reset();\n\t\tthis.register();\n\t}\n\n\tprivate register(): void {\n\t\tG1009EventManager.GetInstance().register(\"JackpotStarted\", this.onJackpotStarted.bind(this));\n\t\tG1009EventManager.GetInstance().register(\"WinDataRespond\", this.onSetFinalReSource.bind(this));\n\t\tG1009EventManager.GetInstance().register(\"StopImmediately\", this.onStopImmediately.bind(this));\n\t\tG1009EventManager.GetInstance().register(\"SpinStarted\", this.onSpinStarted.bind(this));\n\t}\n\n\tprivate onSetFinalReSource(finalResult: any): void {\n\t\tthis.jackpotWinPoint = finalResult.jackpotWinPoint;\n\t}\n\n\tprivate onJackpotStarted(): void {\n\t\tif (this.isStopImmediately)\n\t\t{\n\t\t\tthis.speedUpAnimation();\n\t\t\treturn;\n\t\t}\n\t\tG1009EventManager.GetInstance().notify(\"JackpotPresentationStarted\");\n\t\tlet objTween = {\n\t\t\tvalue: 0\n\t\t};\n\t\tthis.tweenShowPopup = cc.tween(this.spine.node)\n\t\t\t// .delay(4.6)\n\t\t\t.to(FADE_DURATION, { scale: 1 })\n\t\t\t.call(() => {\n\t\t\t\tG1009EventManager.GetInstance().notify(\"JackpotShow\");\n\t\t\t\tthis.content.active = true;\n\t\t\t\tthis.spine.skeletonData = this.skeletonData;\n\t\t\t\tthis.spine.setSkin(\"nohu\");\n\t\t\t\tlet track = this.spine.setAnimation(0, \"animation\", true);\n\t\t\t\t// this.spine.setTrackCompleteListener(track, () => {\n\t\t\t\t// \tthis.spine.setAnimation(0, \"Loop\", true);\n\t\t\t\t// });\n\t\t\t\tcc.tween(this.content)\n\t\t\t\t\t.to(FADE_DURATION, { opacity: 255 })\n\t\t\t\t\t.call(() => {\n\t\t\t\t\t\tthis.countPoint(objTween, this.jackpotWinPoint, COUNT_POINT_DURATION);\n\t\t\t\t\t})\n\t\t\t\t\t.start();\n\t\t\t}).start();\n\n\t}\n\n\tprivate countPoint(objTween: { value: number; }, point1: number, duration: number, delay: number = 0) {\n\t\tthis.tweenCountPoint = cc.tween(objTween)\n\t\t\t.delay(delay)\n\t\t\t.to(duration, { value: point1 }, {\n\t\t\t\tprogress: (start: any, end: any, current: any, ratio: any) => {\n\t\t\t\t\tthis.currentWinPoint = Math.round(current);\n\t\t\t\t\tthis.lblTotalWinPoint.string = G1009Util.Instance().NumberFormatWithoutCharacter(this.currentWinPoint);\n\t\t\t\t\treturn start + (end - start) * ratio;\n\t\t\t\t}\n\t\t\t})\n\t\t\t.call(() => {\n\t\t\t\tthis.lblTotalWinPoint.string = G1009Util.Instance().NumberFormatWithoutCharacter(point1);\n\t\t\t})\n\t\t\t.delay(IDLE_DURATION)\n\t\t\t.call(() => {\n\t\t\t\tcc.tween(this.content)\n\t\t\t\t\t.to(FADE_DURATION, { opacity: 0 }).call(() => {\n\t\t\t\t\t\tG1009EventManager.GetInstance().notify(\"JackpotCompleted\", this.jackpotWinPoint);\n\t\t\t\t\t\t//this.transitionNextState();\n\t\t\t\t\t\tthis.reset();\n\t\t\t\t\t})\n\t\t\t\t\t.start();\n\t\t\t});\n\t\tthis.tweenCountPoint.start();\n\t}\n\n\tprivate transitionNextState(): void {\n\n\t\t// if (G1009GameController.GetInstance().CheckBonusFeatureTrigger())\n\t\t// {\n\t\t// \tG1009EventManager.GetInstance().notify(\"FeatureTrigger\");\n\t\t// \treturn;\n\t\t// }\n\t\t// if (G1009GameController.GetInstance().CheckFreespinContinue())\n\t\t// {\n\t\t// \tG1009EventManager.GetInstance().notify(\"Spin\");\n\t\t// \treturn;\n\t\t// }\n\t\t// if (G1009GameController.GetInstance().CheckFreespinEnd())\n\t\t// {\n\t\t// \tG1009EventManager.GetInstance().notify(\"FeatureComplete\");\n\t\t// \treturn;\n\t\t// }\n\t\t// G1009EventManager.GetInstance().notify(\"EndRound\");\n\t}\n\n\tprivate reset(): void {\n\t\tthis.spine.skeletonData = null;\n\t\tthis.lblTotalWinPoint.string = \"\";\n\t\tthis.content.active = false;\n\t\tthis.content.opacity = 0;\n\t}\n\n\tpublic speedUpAnimation() {\n\t\t\tthis.tweenCountPoint && this.tweenCountPoint.stop();\n\t\t\tG1009EventManager.GetInstance().notify(\"JackpotCompleted\", this.jackpotWinPoint);\n\t\t\tthis.transitionNextState();\n\t\t\tthis.reset();\n\t}\n\n\tprivate onSpinStarted(): void {\n\t\tthis.isStopImmediately = false;\n\t}\n\n\tprivate onStopImmediately(): void {\n\t\tthis.isStopImmediately = true;\n\t}\n}\n"]}