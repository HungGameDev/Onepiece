{"version":3,"sources":["assets\\Script\\UI\\jackpot\\Slot45-jackpot-actor.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Slot45Util from \"../../base/Util/Slot45-number-converter\";\r\nimport Slot45GameController from \"../../base/controller/Slot45-game-controller\";\r\nimport { Slot45EventManager } from \"../../base/events/Slot45-event-manager\";\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nconst FADE_DURATION = 0.25;\r\nconst COUNT_POINT_DURATION = 2;\r\nconst IDLE_DURATION = 1;\r\n@ccclass\r\nexport default class Slot45JackpotActor extends cc.Component {\r\n\r\n\t@property(cc.Node)\r\n\tcontent: cc.Node = null;\r\n\t@property(sp.Skeleton)\r\n\tprivate spine: sp.Skeleton = null;\r\n\t@property(cc.Label)\r\n\tlblTotalWinPoint: cc.Label = null;\r\n\r\n\tprivate tweenShowPopup: cc.Tween;\r\n\tprivate tweenCountPoint: cc.Tween;\r\n\tprivate currentWinPoint: number = 0;\r\n\tprivate jackpotWinPoint: number = 0;\r\n\tprivate isStopImmediately: boolean = false;\r\n\r\n\tprotected onLoad(): void {\r\n\t\tthis.reset();\r\n\t\tthis.register();\r\n\t}\r\n\r\n\tprivate register(): void {\r\n\t\tSlot45EventManager.GetInstance().register(\"JackpotStarted\", this.onJackpotStarted.bind(this));\r\n\t\tSlot45EventManager.GetInstance().register(\"WinDataRespond\", this.onSetFinalReSource.bind(this));\r\n\t\tSlot45EventManager.GetInstance().register(\"StopImmediately\", this.onStopImmediately.bind(this));\r\n\t\tSlot45EventManager.GetInstance().register(\"SpinStarted\", this.onSpinStarted.bind(this));\r\n\t}\r\n\r\n\tprivate onSetFinalReSource(finalResult: any): void {\r\n\t\tthis.jackpotWinPoint = finalResult.jackpotWinPoint;\r\n\t}\r\n\r\n\tprivate onJackpotStarted(): void {\r\n\t\t// if (this.isStopImmediately)\r\n\t\t// {\r\n\t\t// \tthis.speedUpAnimation();\r\n\t\t// \treturn;\r\n\t\t// }\r\n\t\tSlot45EventManager.GetInstance().notify(\"JackpotPresentationStarted\");\r\n\t\tlet objTween = {\r\n\t\t\tvalue: 0\r\n\t\t};\r\n\t\tthis.tweenShowPopup = cc.tween(this.spine.node)\r\n\t\t\t// .delay(4.6)\r\n\t\t\t.to(FADE_DURATION, { scale: 1 })\r\n\t\t\t.call(() => {\r\n\t\t\t\tSlot45EventManager.GetInstance().notify(\"JackpotShow\");\r\n\t\t\t\tthis.content.active = true;\r\n\t\t\t\tlet track = this.spine.setAnimation(0, \"NH\", true);\r\n\t\t\t\t// this.spine.setTrackCompleteListener(track, () => {\r\n\t\t\t\t// \tthis.spine.setAnimation(0, \"Loop\", true);\r\n\t\t\t\t// });\r\n\t\t\t\tcc.tween(this.content)\r\n\t\t\t\t\t.to(FADE_DURATION, { opacity: 255 })\r\n\t\t\t\t\t.call(() => {\r\n\t\t\t\t\t\tthis.countPoint(objTween, this.jackpotWinPoint, COUNT_POINT_DURATION);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.start();\r\n\t\t\t}).start();\r\n\r\n\t}\r\n\r\n\tprivate countPoint(objTween: { value: number; }, point1: number, duration: number, delay: number = 0) {\r\n\t\tthis.tweenCountPoint = cc.tween(objTween)\r\n\t\t\t.delay(delay)\r\n\t\t\t.to(duration, { value: point1 }, {\r\n\t\t\t\tprogress: (start: any, end: any, current: any, ratio: any) => {\r\n\t\t\t\t\tthis.currentWinPoint = Math.round(current);\r\n\t\t\t\t\tthis.lblTotalWinPoint.string = Slot45Util.Instance().NumberFormatWithoutCharacter(this.currentWinPoint);\r\n\t\t\t\t\treturn start + (end - start) * ratio;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.call(() => {\r\n\t\t\t\tthis.lblTotalWinPoint.string = Slot45Util.Instance().NumberFormatWithoutCharacter(point1);\r\n\t\t\t})\r\n\t\t\t.delay(IDLE_DURATION)\r\n\t\t\t.call(() => {\r\n\t\t\t\tcc.tween(this.content)\r\n\t\t\t\t\t.to(FADE_DURATION, { opacity: 0 }).call(() => {\r\n\t\t\t\t\t\tSlot45EventManager.GetInstance().notify(\"JackpotCompleted\", this.jackpotWinPoint);\r\n\t\t\t\t\t\t//this.transitionNextState();\r\n\t\t\t\t\t\tthis.reset();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.start();\r\n\t\t\t});\r\n\t\tthis.tweenCountPoint.start();\r\n\t}\r\n\r\n\tprivate transitionNextState(): void {\r\n\r\n\t\t// if (Slot45GameController.GetInstance().CheckBonusFeatureTrigger())\r\n\t\t// {\r\n\t\t// \tSlot45EventManager.GetInstance().notify(\"FeatureTrigger\");\r\n\t\t// \treturn;\r\n\t\t// }\r\n\t\t// if (Slot45GameController.GetInstance().CheckFreespinContinue())\r\n\t\t// {\r\n\t\t// \tSlot45EventManager.GetInstance().notify(\"Spin\");\r\n\t\t// \treturn;\r\n\t\t// }\r\n\t\t// if (Slot45GameController.GetInstance().CheckFreespinEnd())\r\n\t\t// {\r\n\t\t// \tSlot45EventManager.GetInstance().notify(\"FeatureComplete\");\r\n\t\t// \treturn;\r\n\t\t// }\r\n\t\t// Slot45EventManager.GetInstance().notify(\"EndRound\");\r\n\t}\r\n\r\n\tprivate reset(): void {\r\n\t\tthis.lblTotalWinPoint.string = \"\";\r\n\t\tthis.content.active = false;\r\n\t\tthis.content.opacity = 0;\r\n\t}\r\n\r\n\tpublic speedUpAnimation() {\r\n\t\t\tthis.tweenCountPoint && this.tweenCountPoint.stop();\r\n\t\t\tSlot45EventManager.GetInstance().notify(\"JackpotCompleted\", this.jackpotWinPoint);\r\n\t\t\tthis.transitionNextState();\r\n\t\t\tthis.reset();\r\n\t}\r\n\r\n\tprivate onSpinStarted(): void {\r\n\t\tthis.isStopImmediately = false;\r\n\t}\r\n\r\n\tprivate onStopImmediately(): void {\r\n\t\tthis.isStopImmediately = true;\r\n\t}\r\n}\r\n"]}